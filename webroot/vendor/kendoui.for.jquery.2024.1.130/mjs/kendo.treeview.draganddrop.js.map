{"version":3,"file":"kendo.treeview.draganddrop.js","names":["__meta__","id","name","category","depends","advanced","$","undefined$1","kendo","window","ui","extend","VISIBILITY","DRAG_STATUS","DRAG_STATUS_ELEMENT","KSTATEHOVER","HierarchicalDragAndDrop","Class","init","element","options","this","hovered","dragstart","noop","drag","drop","dragend","_draggable","Draggable","ignore","filter","autoScroll","cursorOffset","left","top","support","mobileOS","zoomLevel","hint","_hint","bind","dragcancel","hintDestroyed","holdToDrag","clickMoveClick","hintText","_removeTouchHover","touch","find","removeClass","_hintStatus","newStatus","statusElement","status","icon","replaceWith","e","dropHint","remove","source","currentTarget","closest","itemSelector","preventDefault","reorderable","css","appendTo","hoveredItem","itemHeight","itemTop","itemContent","delta","insertOnTop","insertOnBottom","addChild","itemData","position","target","dropTarget","eventTarget","container","allowedContainers","length","contains","hasClass","itemFromTarget","item","_outerHeight","content","getOffset","y","location","_lastHover","toggleClass","dropHintContainer","first","last","originalEvent","pageY","pageX","x","setStatus","value","indexOf","destination","eventArgs","dropPrevented","requireTarget","dropPositionFrom","valid","setValid","newValid","dropped","destroy","jQuery","kendo$1"],"sources":["kendo.treeview.draganddrop.js"],"mappings":"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","sourcesContent":["import './kendo.data.js';\nimport './kendo.draganddrop.js';\n\nvar __meta__ = {\n    id: \"treeview.draganddrop\",\n    name: \"Hierarchical Drag & Drop\",\n    category: \"framework\",\n    depends: [ \"core\", \"draganddrop\" ],\n    advanced: true\n};\n\n(function($, undefined$1) {\n    var kendo = window.kendo;\n    var ui = kendo.ui;\n    var extend = $.extend;\n    var VISIBILITY = \"visibility\";\n    var DRAG_STATUS = \"k-drag-status\";\n    var DRAG_STATUS_ELEMENT = `<span class=\"${DRAG_STATUS}\"></span>`;\n    var KSTATEHOVER = \"k-hover\";\n    var INPUTSELECTOR = \"input,a:not(.k-in),textarea,.k-multiselect-wrap,select,button,a.k-button>.k-icon,.k-button>.k-button-text,button.k-button>.k-icon,span.k-toggle-icon,a.k-button>.k-svg-icon,button.k-button>.k-svg-icon,.k-button>.k-svg-icon>svg,.k-button>.k-svg-icon>svg>path\";\n    var DROPHINTTEMPLATE = \"<div class='k-drop-hint k-drop-hint-h'>\" +\n                                \"<div class='k-drop-hint-start'></div>\" +\n                                \"<div class='k-drop-hint-line'></div>\" +\n                            \"</div>\";\n\n    ui.HierarchicalDragAndDrop = kendo.Class.extend({\n        init: function(element, options) {\n            this.element = element;\n            this.hovered = element;\n            this.options = extend({\n                dragstart: $.noop, drag: $.noop, drop: $.noop, dragend: $.noop\n            }, options);\n\n            this._draggable = new ui.Draggable(element, {\n                ignore: INPUTSELECTOR,\n                filter: options.filter,\n                autoScroll: options.autoScroll,\n                cursorOffset: {\n                    left: 10,\n                    top: kendo.support.mobileOS ? -40 / kendo.support.zoomLevel() : 10\n                },\n                hint: this._hint.bind(this),\n                dragstart: this.dragstart.bind(this),\n                dragcancel: this.dragcancel.bind(this),\n                hintDestroyed: this.dragcancel.bind(this),\n                drag: this.drag.bind(this),\n                dragend: this.dragend.bind(this),\n                holdToDrag: options.holdToDrag,\n                clickMoveClick: options.clickMoveClick\n            });\n        },\n\n        _hint: function(element) {\n            return \"<div class='k-drag-clue'>\" +\n                        DRAG_STATUS_ELEMENT +\n                        this.options.hintText(element) +\n                    \"</div>\";\n        },\n\n        _removeTouchHover: function() {\n            if (kendo.support.touch && this.hovered) {\n                this.hovered.find(\".\" + KSTATEHOVER).removeClass(KSTATEHOVER);\n                this.hovered = false;\n            }\n        },\n\n        _hintStatus: function(newStatus) {\n            var statusElement = this._draggable.hint.find(`.${DRAG_STATUS}`);\n            if (newStatus) {\n                this.status = newStatus;\n                ui.icon(statusElement, {\n                    icon: newStatus\n                });\n            } else {\n                this.status = '';\n                statusElement.replaceWith(DRAG_STATUS_ELEMENT);\n            }\n        },\n\n        dragstart: function(e) {\n            if (this.dropHint) {\n                this.dropHint.remove();\n            }\n\n            this.source = e.currentTarget.closest(this.options.itemSelector);\n\n            if (this.options.dragstart(this.source)) {\n                e.preventDefault();\n            }\n\n            if (this.options.reorderable) {\n                this.dropHint = $(DROPHINTTEMPLATE)\n                    .css(VISIBILITY, \"hidden\")\n                    .appendTo(this.element);\n            } else {\n                this.dropHint = $();\n            }\n        },\n\n        drag: function(e) {\n            var options = this.options;\n            var source = this.source;\n            var target = this.dropTarget = $(kendo.eventTarget(e));\n            var container = target.closest(options.allowedContainers);\n            var hoveredItem, itemHeight, itemTop, itemContent, delta;\n            var insertOnTop, insertOnBottom, addChild;\n            var itemData, position, status;\n\n            if (!container.length) {\n                // dragging outside of allowed elements\n                status = \"cancel\";\n                this._removeTouchHover();\n            } else if (source[0] == target[0] || options.contains(source[0], target[0])) {\n                // dragging item within itself\n                status = \"cancel\";\n            } else if (e.clickMoveClick && e.currentTarget.hasClass(\"k-drag-cell\") && target.closest(\".k-drag-cell\").length === 0) {\n                // click-move-click interaction with drag cell\n                status = \"cancel\";\n            } else if (e.clickMoveClick && e.currentTarget.hasClass(\"k-treeview-leaf\") && target.closest(\".k-treeview-leaf\").length === 0) {\n                // click-move-click interaction with TreeView\n                status = \"cancel\";\n            } else {\n                // moving or reordering item\n                status = \"insert-middle\";\n\n                itemData = options.itemFromTarget(target);\n                hoveredItem = itemData.item;\n\n                if (hoveredItem.length) {\n                    this._removeTouchHover();\n                    itemHeight = kendo._outerHeight(hoveredItem);\n                    itemContent = itemData.content;\n\n                    if (options.reorderable) {\n                        delta = itemHeight / (itemContent.length > 0 ? 4 : 2);\n                        itemTop = kendo.getOffset(hoveredItem).top;\n\n                        insertOnTop = e.y.location < (itemTop + delta);\n                        insertOnBottom = (itemTop + itemHeight - delta) < e.y.location;\n                        addChild = itemContent.length && !insertOnTop && !insertOnBottom;\n                    } else {\n                        addChild = true;\n                        insertOnTop = false;\n                        insertOnBottom = false;\n                    }\n\n                    this.hovered = addChild ? container : false;\n\n                    this.dropHint.css(VISIBILITY, addChild ? \"hidden\" : \"visible\");\n\n                    if (this._lastHover && this._lastHover[0] != itemContent[0]) {\n                        this._lastHover.removeClass(KSTATEHOVER);\n                    }\n\n                    this._lastHover = itemContent.toggleClass(KSTATEHOVER, addChild);\n\n                    if (addChild) {\n                        status = \"plus\";\n                    } else {\n                        position = hoveredItem.position();\n                        position.top += insertOnTop ? 0 : itemHeight;\n\n                        this.dropHint.css(position)\n                            [insertOnTop ? \"prependTo\" : \"appendTo\"]\n                            (options.dropHintContainer(hoveredItem));\n\n                        if (insertOnTop && itemData.first) {\n                            status = \"insert-top\";\n                        }\n\n                        if (insertOnBottom && itemData.last) {\n                            status = \"insert-bottom\";\n                        }\n                    }\n                } else if (target[0] != this.dropHint[0]) {\n                    if (this._lastHover) {\n                        this._lastHover.removeClass(KSTATEHOVER);\n                    }\n\n                    if (!$.contains(this.element[0], container[0])) {\n                        // moving node to different element\n                        status = \"plus\";\n                    } else {\n                        status = \"cancel\";\n                    }\n                }\n            }\n\n            this.options.drag({\n                originalEvent: e.originalEvent,\n                source: source,\n                target: target,\n                pageY: e.y.location,\n                pageX: e.x.location,\n                status: status,\n                setStatus: function(value) {\n                    status = value;\n                }\n            });\n\n            if (status.indexOf(\"insert\") !== 0) {\n                this.dropHint.css(VISIBILITY, \"hidden\");\n            }\n\n            this._hintStatus(status);\n        },\n\n        dragcancel: function() {\n            if (this.dropHint) {\n                this.dropHint.remove();\n            }\n        },\n\n        dragend: function(e) {\n            var position = \"over\",\n                source = this.source,\n                destination,\n                dropHint = this.dropHint,\n                dropTarget = this.dropTarget || $(kendo.eventTarget(e)),\n                eventArgs, dropPrevented, requireTarget;\n\n            if (dropHint && dropHint.css(VISIBILITY) == \"visible\") {\n                position = this.options.dropPositionFrom(dropHint);\n                destination = dropHint.closest(this.options.itemSelector);\n                requireTarget = true;\n            } else if (dropTarget) {\n                destination = dropTarget.closest(this.options.itemSelector);\n\n                // moving node to root element\n                if (!destination.length) {\n                    destination = dropTarget.closest(this.options.allowedContainers);\n                }\n            }\n\n            if (requireTarget && !destination.length) {\n                this.dragcancel();\n                return;\n            }\n\n            eventArgs = {\n                originalEvent: e.originalEvent,\n                source: source[0],\n                destination: destination[0],\n                valid: this.status != \"cancel\",\n                setValid: function(newValid) {\n                    this.valid = newValid;\n                },\n                dropTarget: dropTarget[0],\n                position: position\n            };\n\n            dropPrevented = this.options.drop(eventArgs);\n\n            dropHint.remove();\n            this._removeTouchHover();\n            if (this._lastHover) {\n                this._lastHover.removeClass(KSTATEHOVER);\n            }\n\n            if (!eventArgs.valid || dropPrevented) {\n                this._draggable.dropped = eventArgs.valid;\n                return;\n            }\n\n            this._draggable.dropped = true;\n\n            this.options.dragend({\n                originalEvent: e.originalEvent,\n                source: source,\n                destination: destination,\n                position: position\n            });\n        },\n\n        destroy: function() {\n            this._lastHover = this.hovered = null;\n            this._draggable.destroy();\n        }\n    });\n\n})(window.kendo.jQuery);\nvar kendo$1 = kendo;\n\nexport { kendo$1 as default };\n"]}